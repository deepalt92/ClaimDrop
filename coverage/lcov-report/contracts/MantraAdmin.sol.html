<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts\MantraAdmin.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> MantraAdmin.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">87.93% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>51/58</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">53.45% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>31/58</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>12/12</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">83.78% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>62/74</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;
import "@openzeppelin/contracts/access/extensions/AccessControlEnumerable.sol";
import "./interfaces/IMantraClaimDropV2.sol";
&nbsp;
abstract contract MantraAdmin is IMantraClaimDropV2, AccessControlEnumerable {
    bytes32 public constant AUTHORIZED_ROLE = keccak256("AUTHORIZED_ROLE"); 
    bytes32 public constant BLACKLISTER_ROLE = keccak256("BLACKLISTER_ROLE");
&nbsp;
    Campaign public campaign;
    // current owner (primary DEFAULT_ADMIN_ROLE holder at initialization)
    address public owner;
    address public pendingOwner;
    uint256 public ownershipExpiry;
     mapping(address =&gt; bool) public blacklisted; // track blacklisted addresses
     // authorize or revoke admin
    function manageAuthorizedWallets(address[] calldata acct, bool allow) external <span class="missing-if-branch" title="else path not taken" >E</span>onlyRole(DEFAULT_ADMIN_ROLE) {
        for (uint256 i = 0; i &lt; acct.length; i++) {
            if (allow) {
                grantRole(AUTHORIZED_ROLE, acct[i]);
                grantRole(BLACKLISTER_ROLE, acct[i]);
            } else {
                revokeRole(AUTHORIZED_ROLE, acct[i]);
                revokeRole(BLACKLISTER_ROLE, acct[i]);
            }
            emit AuthorizedToggled(acct[i], allow);
        }
    }
&nbsp;
    function isAuthorized(address acct) public view returns (bool) {
        return hasRole(AUTHORIZED_ROLE, acct);
    }
&nbsp;
    /**
     * @notice Return a paginated list of authorized wallets (AUTHORIZED_ROLE members)
     * @param startAfter Address to start after (use address(0) to start from beginning)
     * @param limit Maximum number of addresses to return (0 =&gt; defaults to 50)
     * @return wallets Array of authorized wallet addresses
     *
     * Behaviour: If startAfter != address(0) and is not found among role members, returns empty array.
     */
    function getAuthorizedWallets(address startAfter, uint256 limit) public view returns (address[] memory wallets) {
        uint256 total = getRoleMemberCount(AUTHORIZED_ROLE);
        <span class="missing-if-branch" title="if path not taken" >I</span>if (total == 0) {
<span class="cstat-no" title="statement not covered" >            return new address[](0);</span>
        }
&nbsp;
        uint256 startIndex = 0;
        <span class="missing-if-branch" title="if path not taken" >I</span>if (startAfter != address(0)) {
<span class="cstat-no" title="statement not covered" >            bool found = false;</span>
<span class="cstat-no" title="statement not covered" >            for (uint256 i = 0; i &lt; total; i++) {</span>
<span class="cstat-no" title="statement not covered" >                if (getRoleMember(AUTHORIZED_ROLE, i) == startAfter) {</span>
                    startIndex = i + 1; // start after the found element
                    found = true;
                    break;
                }
            }
<span class="cstat-no" title="statement not covered" >            if (!found) {</span>
<span class="cstat-no" title="statement not covered" >                return new address[](0);</span>
            }
        }
&nbsp;
        <span class="missing-if-branch" title="if path not taken" >I</span>if (limit == 0) {
            limit = 50;
        }
&nbsp;
        <span class="missing-if-branch" title="if path not taken" >I</span>if (startIndex &gt;= total) {
<span class="cstat-no" title="statement not covered" >            return new address[](0);</span>
        }
&nbsp;
        uint256 remaining = total - startIndex;
        uint256 take = remaining &lt; limit ? remaining : <span class="missing-if-branch" title="else path not taken" >E</span>limit;
&nbsp;
        wallets = new address[](take);
        for (uint256 i = 0; i &lt; take; i++) {
            wallets[i] = getRoleMember(AUTHORIZED_ROLE, startIndex + i);
        }
        return wallets;
    }
     // Replace a placeholder id (with zero-address) with actual wallet. Keeps claimed amounts attached.
    function replaceAddress(address oldWallet, address newWallet) external <span class="missing-if-branch" title="else path not taken" >E</span>onlyRole(AUTHORIZED_ROLE) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(oldWallet != address(0), "oldWallet zero");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(newWallet != address(0), "newWallet zero");
        uint256 len = campaign.allocations.length;
        for (uint256 i = 0; i &lt; len; i++) {
            if (campaign.allocations[i].wallet == oldWallet) {
                campaign.allocations[i].wallet = newWallet;
                emit ReplacedAddress(oldWallet, newWallet);
            }
        }
    }
&nbsp;
    function removeAllocationByIndexPreserveOrder(uint256 i) internal {
        uint256 len = campaign.allocations.length;
        <span class="missing-if-branch" title="else path not taken" >E</span>require(i &lt; len, "index OOB");
        for (uint256 j = i; j + 1 &lt; len; ++j) {
            campaign.allocations[j] = campaign.allocations[j + 1];
        }
        campaign.allocations.pop();
    }
&nbsp;
    // remove address from allocation
    function removeAddress(address wallet) external <span class="missing-if-branch" title="else path not taken" >E</span>onlyRole(AUTHORIZED_ROLE) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(wallet != address(0), "wallet zero");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(block.timestamp &lt; campaign.startTime, "campaign active");
        uint256 len = campaign.allocations.length;
        for (uint256 i = 0; i &lt; len; i++) {
            if (campaign.allocations[i].wallet == wallet) {
                removeAllocationByIndexPreserveOrder(i);
                emit AddressRemoved(wallet);
            }
        }
    }
&nbsp;
    function blacklistAddress(address acct, bool _blacklisted) external <span class="missing-if-branch" title="else path not taken" >E</span>onlyRole(BLACKLISTER_ROLE) {
        blacklisted[acct] = _blacklisted;
        emit Blacklisted(acct, _blacklisted);
    }
&nbsp;
    function isBlacklisted(address acct) public view returns (bool) {
        return blacklisted[acct];
    }
&nbsp;
    /**
     * @notice Proposes to transfer the contract's ownership to a new account
     * @param newOwner The address to transfer ownership to
     * @param expiry The timestamp until which the ownership transfer can be accepted (0 for no expiry)
     */
    function proposeOwnership(address newOwner, uint256 expiry) external <span class="missing-if-branch" title="else path not taken" >E</span>onlyRole(DEFAULT_ADMIN_ROLE) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(newOwner != address(0), "Zero address owner");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(expiry == 0 || expiry &gt; block.timestamp, "Invalid expiry time");
        
        pendingOwner = newOwner;
        ownershipExpiry = expiry;
        
        emit OwnershipProposed(newOwner, expiry);
    }
&nbsp;
    /**
     * @notice Accepts a pending ownership transfer. Can only be called by the pending owner.
     */
    function acceptOwnership() external {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(msg.sender == pendingOwner, "Not pending owner");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(<span class="branch-0 cbranch-no" title="branch not covered" >ownershipExpiry == 0</span> || block.timestamp &lt;= ownershipExpiry, "Transfer expired");
&nbsp;
        address previousOwner = owner;
&nbsp;
        // grant role to the new owner and revoke from the previous owner
        _grantRole(DEFAULT_ADMIN_ROLE, pendingOwner);
        <span class="missing-if-branch" title="else path not taken" >E</span>if (previousOwner != address(0)) {
            _revokeRole(DEFAULT_ADMIN_ROLE, previousOwner);
        }
&nbsp;
        // set the new owner
        owner = pendingOwner;
&nbsp;
        // Clear pending ownership data
        pendingOwner = address(0);
        ownershipExpiry = 0;
&nbsp;
        emit OwnershipTransferred(previousOwner, owner);
    }
&nbsp;
    /**
     * @notice Cancels a pending ownership transfer. Can only be called by the current owner.
     */
    function cancelOwnershipTransfer() external <span class="missing-if-branch" title="else path not taken" >E</span>onlyRole(DEFAULT_ADMIN_ROLE) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(pendingOwner != address(0), "No pending transfer");
        
        address cancelledOwner = pendingOwner;
        pendingOwner = address(0);
        ownershipExpiry = 0;
&nbsp;
        emit OwnershipTransferCancelled(cancelledOwner);
    }
&nbsp;
    /**
     * @notice Return ownership triplet
     * @return current owner, pending owner, pending expiry timestamp
     */
    function checkOwnership() public view returns (address, address, uint256) {
        return (owner, pendingOwner, ownershipExpiry);
    }
&nbsp;
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed Nov 05 2025 21:19:03 GMT+1100 (Australian Eastern Daylight Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
